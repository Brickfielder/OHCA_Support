<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OHCA Follow-up Sites Map</title>
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    :root{
      --card:#fbeaec;    /* soft pink shell */
      --radius:18px;
      --shadow:0 10px 24px rgba(0,0,0,.08);
      --text:#1b1b1f;
      --muted:#5a5f6a;
      --brand:#8c0f24;
    }
    body{margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--text); background:#fff;}
    .wrap{max-width:1100px; margin:32px auto; padding:0 16px;}
    .map-card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
      border:1px solid rgba(140,15,36,.12);
    }
    .map-title{
      font-size:1.1rem; font-weight:700; margin:4px 8px 12px;
      letter-spacing:.2px;
    }
    #map{height:520px; width:100%; border-radius:calc(var(--radius) - 6px); overflow:hidden; border:1px solid rgba(0,0,0,.06);}
    /* Popup content styling */
    .popup h3{margin:.2rem 0 .35rem; font-size:1.05rem;}
    .popup ul{margin:.25rem 0 .25rem 1.2rem; padding:0;}
    .popup li{margin:.15rem 0;}
    .badge{
      display:inline-block; font-size:.82rem; padding:.2rem .5rem; border-radius:999px;
      border:1px solid rgba(140,15,36,.35); color:var(--brand); background:#fff; margin-top:.4rem;
    }
    .muted{color:var(--muted); font-size:.9rem;}
    /* Emoji marker wrapper to improve visibility on varied backgrounds */
    .emoji-marker {
      background: #ffffff;
      border: 1px solid rgba(0,0,0,.15);
      border-radius: 50%;
      width: 34px; height: 34px;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 2px 6px rgba(0,0,0,.15);
      line-height: 1;
    }
    .emoji-marker span {
      font-size: 22px;
      transform: translateY(1px);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="map-card">
      <div class="map-title">Cardiac Arrest Follow-up Services ‚Äî Selected Sites</div>
      <div id="map" role="region" aria-label="Map of follow-up clinics"></div>
      <div class="muted" style="margin:10px 8px 0;">
        Tip: click a hospital icon to see the assessments used at follow-up.
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script>
    // Initialize map
    const map = L.map('map', {
      scrollWheelZoom: true,
      attributionControl: true
    });

    // Base layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Sites (approximate coordinates)
    const sites = [
      {
        name: "Essex Cardiothoracic Centre (Basildon University Hospital)",
        lat: 51.5719, lon: 0.4625,
        assessments: ["HADS", "MoCA", "EQ-5D-5L"],
        status: "running"
      },
      {
        name: "Barts Heart Centre (St Bartholomew‚Äôs Hospital)",
        lat: 51.5174, lon: -0.0965,
        assessments: ["MoCA or FreeCog or ACE-III", "HADS", "EQ-5D-5L"],
        status: "running"
      },
      {
        name: "King‚Äôs College Hospital (Denmark Hill)",
        lat: 51.4683, lon: -0.0890,
        assessments: ["HADS", "MoCA", "EQ-5D-5L", "ACE-III"],
        status: "not_running",
        note: "Clinic not running as of 18 August 2025"
      },
      {
        name: "Norfolk and Norwich University Hospital",
        lat: 52.6229, lon: 1.2227,
        assessments: ["PHQ-9", "GAD-7", "ACE-III", "EQ-5D-5L"],
        status: "not_running",
        note: "Clinic not running as of 18 August 2025"
      }
    ];

    // Custom hospital emoji icon
    function hospitalEmojiIcon() {
      return L.divIcon({
        className: "",
        html: '<div class="emoji-marker" aria-hidden="true"><span>üè•</span></div>',
        iconSize: [34, 34],
        iconAnchor: [17, 32],
        popupAnchor: [0, -28]
      });
    }

    // Add markers
    const markers = [];
    sites.forEach(s => {
      const popupHTML = `
        <div class="popup">
          <h3>${s.name}</h3>
          <strong>Assessments at follow-up:</strong>
          <ul>${s.assessments.map(a => `<li>${a}</li>`).join("")}</ul>
          ${s.status === "not_running"
            ? `<div class="badge">${s.note}</div>`
            : ""
          }
        </div>
      `;
      const m = L.marker([s.lat, s.lon], { icon: hospitalEmojiIcon() })
                 .addTo(map)
                 .bindPopup(popupHTML, { maxWidth: 320 });
      markers.push(m);
    });

    // Fit bounds to all markers with some padding
    const group = L.featureGroup(markers);
    map.fitBounds(group.getBounds(), { padding: [32, 32] });
  </script>
</body>
</html>
